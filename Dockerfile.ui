FROM node:20-bookworm-slim

WORKDIR /app

RUN corepack enable

ENV NEXT_TELEMETRY_DISABLED=1

COPY ui/package.json ui/pnpm-lock.yaml ./
RUN pnpm install --no-frozen-lockfile

COPY ui ./

ARG NEXT_PUBLIC_API_BASE=http://localhost:8000
ENV NEXT_PUBLIC_API_BASE=${NEXT_PUBLIC_API_BASE}

RUN pnpm build

EXPOSE 3000

CMD ["pnpm", "start", "-p", "3000"]
