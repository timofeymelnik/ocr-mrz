services:
  api:
    build:
      context: .
      dockerfile: Dockerfile.api
    platform: linux/arm/v7
    env_file:
      - .env
    environment:
      PLAYWRIGHT_CHROMIUM_EXECUTABLE_PATH: /usr/bin/chromium
      MONGODB_URI: ${MONGODB_URI:-}
      MONGODB_DB: ${MONGODB_DB:-ocr_mrz}
      MONGODB_COLLECTION: ${MONGODB_COLLECTION:-crm_documents}
      DISPLAY: ${DISPLAY:-}
      QT_X11_NO_MITSHM: "1"
    ports:
      - "8000:8000"
    volumes:
      - ./runtime:/app/runtime
      - ./downloads:/app/downloads
      - ./input:/app/input
      - /tmp/.X11-unix:/tmp/.X11-unix

  ui:
    build:
      context: .
      dockerfile: Dockerfile.ui
      args:
        NEXT_PUBLIC_API_BASE: ${NEXT_PUBLIC_API_BASE:-http://localhost:8000}
    platform: linux/arm/v7
    environment:
      NEXT_PUBLIC_API_BASE: ${NEXT_PUBLIC_API_BASE:-http://localhost:8000}
    ports:
      - "3000:3000"
    depends_on:
      - api
